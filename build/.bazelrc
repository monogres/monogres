# /* vim: set filetype=sh : */

common --show_timestamps
common --progress_in_terminal_title
common --incompatible_disallow_empty_glob
common --attempt_to_print_relative_paths
common --check_direct_dependencies=off
common --keep_going

common:debug --announce_rc
common:debug --experimental_ui_max_stdouterr_bytes=52428800
common:debug --nokeep_going

common:remote --ui_actions_shown 100

# Add mirrors for certain download URLs
common --experimental_downloader_config=.bazel_downloader.cfg

build --nostamp
build --incompatible_strict_action_env
build --reuse_sandbox_directories
build --incompatible_default_to_explicit_init_py
build --nolegacy_external_runfiles
build --nobuild_runfile_links
build --noaction_cache_store_output_metadata
build --guard_against_concurrent_changes
build --repo_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1
build --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1

# Build Event Service (BES):
# build events can be uploaded to services like BuildBuddy to get
# a nice UI and a URL that you can share with others to debug or
# review the results of a build.
# https://bazel.build/remote/bep#build-event-service
build:bes-buildbuddy --bes_results_url=https://app.buildbuddy.io/invocation/
build:bes-buildbuddy --bes_backend=grpcs://remote.buildbuddy.io
build:bes-buildbuddy --bes_upload_mode=nowait_for_upload_complete

build:debug --config=bes-buildbuddy
build:debug --show_result=9999
build:debug --verbose_failures
build:debug --verbose_explanations
build:debug --explain=/tmp/verbose_explanations
build:debug --sandbox_debug
build:debug --subcommands

common:linux-amd64 --extra_toolchains=@llvm_toolchain_system_linux_amd64//:cc-toolchain-x86_64-linux
common:linux-arm64 --extra_toolchains=@llvm_toolchain_system_linux_arm64//:cc-toolchain-aarch64-linux

common:linux-amd64-buildbuddy --config=linux-amd64
common:linux-amd64-buildbuddy --platforms=//toolchains:linux_amd64_rbe_buildbuddy
common:linux-amd64-buildbuddy --extra_execution_platforms=//toolchains:linux_amd64_rbe_buildbuddy

common:linux-arm64-buildbuddy --config=linux-arm64
common:linux-arm64-buildbuddy --platforms=//toolchains:linux_arm64_rbe_buildbuddy
common:linux-arm64-buildbuddy --extra_execution_platforms=//toolchains:linux_arm64_rbe_buildbuddy

common:linux-amd64-buildbarn --config=linux-amd64
common:linux-amd64-buildbarn --platforms=//toolchains:linux_amd64_rbe_buildbarn
common:linux-amd64-buildbarn --extra_execution_platforms=//toolchains:linux_amd64_rbe_buildbarn

common:linux-arm64-buildbarn --config=linux-arm64
common:linux-arm64-buildbarn --platforms=//toolchains:linux_arm64_rbe_buildbarn
common:linux-arm64-buildbarn --extra_execution_platforms=//toolchains:linux_arm64_rbe_buildbarn

build:remote --define=EXECUTOR=remote
build:remote --strategy=remote
build:remote --spawn_strategy=remote
build:remote --genrule_strategy=remote
build:remote --jobs=50
build:remote --nolegacy_important_outputs
build:remote --noslim_profile
build:remote --experimental_profile_include_target_label
build:remote --experimental_profile_include_primary_output
build:remote --noremote_upload_local_results
build:remote --remote_timeout=5m

build:remote-buildbuddy --config=remote --config=bes-buildbuddy
build:remote-buildbuddy --remote_executor=grpcs://remote.buildbuddy.io
build:remote-buildbuddy --experimental_remote_cache_compression
build:remote-buildbuddy --experimental_remote_cache_compression_threshold=100  # bytes

build:remote-buildbarn --config=remote --config=bes-buildbuddy
build:remote-buildbarn --remote_executor=grpcs://rbe.monogres.dev

# custom bazelrc where each user can add their customizations and/or
# e.g. authentication parts that shouldn't be committed to the repo.
# see .bazelrc.user.tmpl for a sample template you can use
try-import .bazelrc.user
